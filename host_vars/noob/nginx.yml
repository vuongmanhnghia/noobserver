---
# Nginx
nginx_http_port: 80
nginx_https_port: 443
nginx_vhost_path: /etc/nginx/sites-available
nginx_remove_default_vhost: true

nginx_vhosts:
  # === GITLAB ===
  - listen: "80"
    server_name: "{{ gitlab_domain }}"
    return: "301 https://$host$request_uri"
    filename: "{{ gitlab_domain }}.conf"

  - listen: "443 ssl"
    server_name: "{{ gitlab_domain }}"
    extra_parameters: |
      ssl_certificate /etc/letsencrypt/live/{{ gitlab_domain }}/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/{{ gitlab_domain }}/privkey.pem;
      ssl_protocols TLSv1.2 TLSv1.3;
      ssl_ciphers HIGH:!aNULL:!MD5;

      location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      }
    filename: "{{ gitlab_domain }}-ssl.conf"

  # # --- CẤU HÌNH CHO TRANG CHÍNH (nooblearn2code.com) ---
  # - listen: "80"
  #   server_name: "nooblearn2code.com www.nooblearn2code.com"
  #   return: "301 https://nooblearn2code.com$request_uri"
  #   filename: "main-site.conf"

  # - listen: "443 ssl"
  #   server_name: "nooblearn2code.com www.nooblearn2code.com"
  #   root: "/var/www/html/main-site" # Đường dẫn code web chính
  #   index: index.html
  #   extra_parameters: |
  #     # LƯU Ý: Trỏ vào thư mục tên nooblearn2code.com (Domain đầu tiên trong list Cert 2)
  #     ssl_certificate /etc/letsencrypt/live/nooblearn2code.com/fullchain.pem;
  #     ssl_certificate_key /etc/letsencrypt/live/nooblearn2code.com/privkey.pem;
  #   filename: "main-site-ssl.conf"

  # === ETHNOSOUL LEGACY ===
  - listen: "80"
    server_name: "ethnosoul-legacy.vn"
    return: "301 https://$host$request_uri"
    filename: "ethnosoul-legacy.vn.conf"

  - listen: "443 ssl"
    server_name: "ethnosoul-legacy.vn"
    extra_parameters: |
      ssl_certificate /etc/letsencrypt/live/ethnosoul-legacy.vn/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/ethnosoul-legacy.vn/privkey.pem;
      ssl_protocols TLSv1.2 TLSv1.3;
      ssl_ciphers HIGH:!aNULL:!MD5;

      location / {
        proxy_pass http://localhost:3010;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      }
    filename: "ethnosoul-legacy.vn-ssl.conf"

  - listen: "80"
    server_name: "api.ethnosoul-legacy.vn"
    return: "301 https://$host$request_uri"
    filename: "ethnosoul-legacy.vn.conf"

  - listen: "443 ssl"
    server_name: "api.ethnosoul-legacy.vn"
    extra_parameters: |
      ssl_certificate /etc/letsencrypt/live/api.ethnosoul-legacy.vn/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/api.ethnosoul-legacy.vn/privkey.pem;
      ssl_protocols TLSv1.2 TLSv1.3;
      ssl_ciphers HIGH:!aNULL:!MD5;

      location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      }
    filename: "api.ethnosoul-legacy.vn-ssl.conf"

  # === MINECRAFT SERVER PROXY ===
  - listen: "80"
    server_name: "minecraft.nooblearn2code.com"
    return: "301 https://$host$request_uri"
    filename: "minecraft.nooblearn2code.com.conf"

  - listen: "443 ssl"
    server_name: "minecraft.nooblearn2code.com"
    extra_parameters: |
      ssl_certificate /etc/letsencrypt/live/minecraft.nooblearn2code.com/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/minecraft.nooblearn2code.com/privkey.pem;
      ssl_protocols TLSv1.2 TLSv1.3;
      ssl_ciphers HIGH:!aNULL:!MD5;

      location / {
        proxy_pass http://localhost:25565;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      }
    filename: "minecraft.nooblearn2code.com-ssl.conf"

  # === PORTAINER ===
  - listen: "80"
    server_name: "portainer.nooblearn2code.com"
    return: "301 https://$host$request_uri"
    filename: "portainer.nooblearn2code.com.conf"

  - listen: "443 ssl"
    server_name: "portainer.nooblearn2code.com"
    extra_parameters: |
      ssl_certificate /etc/letsencrypt/live/portainer.nooblearn2code.com/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/portainer.nooblearn2code.com/privkey.pem;
      ssl_protocols TLSv1.2 TLSv1.3;
      ssl_ciphers HIGH:!aNULL:!MD5;

      location / {
        proxy_pass https://localhost:9443;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      }
    filename: "portainer.nooblearn2code.com-ssl.conf"